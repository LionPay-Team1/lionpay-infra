# ğŸ± LionPay Kubernetes ë§¤ë‹ˆí˜ìŠ¤íŠ¸

LionPay í”„ë¡œì íŠ¸ì˜ ì¿ ë²„ë„¤í‹°ìŠ¤ ë°°í¬ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì…ë‹ˆë‹¤.

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
kubernetes/
â”œâ”€â”€ base/                          # â­ ê³µí†µ ì„¤ì • (ëª¨ë“  í™˜ê²½ì—ì„œ ê³µìœ )
â”‚   â”œâ”€â”€ namespace.yaml             # Kubernetes ë„¤ì„ìŠ¤í˜ì´ìŠ¤
â”‚   â”œâ”€â”€ configmap.yaml             # í™˜ê²½ë³€ìˆ˜ ë° ì„¤ì • (CORS, API ì£¼ì†Œ)
â”‚   â”œâ”€â”€ auth-service.yaml          # Auth ì„œë¹„ìŠ¤ (ClusterIP)
â”‚   â”œâ”€â”€ auth-deployment.yaml       # Auth ë°°í¬ (2 replicas)
â”‚   â”œâ”€â”€ wallet-service.yaml        # Wallet ì„œë¹„ìŠ¤ (ClusterIP)
â”‚   â”œâ”€â”€ wallet-deployment.yaml     # Wallet ë°°í¬ (2 replicas)
â”‚   â”œâ”€â”€ ingress.yaml               # ALB Ingress (HTTP only - CloudFrontê°€ HTTPS ì²˜ë¦¬)
â”‚   â”œâ”€â”€ hpa.yaml                   # ìë™ í™•ì¥ (Auto Scaling)
â”‚   â”œâ”€â”€ pdb.yaml                   # Pod Disruption Budget (ê³ ê°€ìš©ì„±)
â”‚   â””â”€â”€ kustomization.yaml         # Kustomize í†µí•© ì„¤ì •
â”‚
â”œâ”€â”€ overlays/
â”‚   â”œâ”€â”€ dev/                       # ğŸ”§ Dev í™˜ê²½ ì„¤ì • (ê°œë°œ/í…ŒìŠ¤íŠ¸)
â”‚   â”‚   â””â”€â”€ kustomization.yaml     # Dev í™˜ê²½ë³„ ì»¤ìŠ¤í„°ë§ˆì´ì§•
â”‚   â”‚
â”‚   â””â”€â”€ prod/                      # ğŸ”’ Prod í™˜ê²½ ì„¤ì • (í”„ë¡œë•ì…˜)
â”‚       â””â”€â”€ kustomization.yaml     # Prod í™˜ê²½ë³„ ì»¤ìŠ¤í„°ë§ˆì´ì§•
â”‚
â”œâ”€â”€ QUICKSTART.md                  # ğŸ“Œ 5ë¶„ ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ
â”œâ”€â”€ DEPLOYMENT_GUIDE.md            # ğŸ“– ìƒì„¸ ë°°í¬ ê°€ì´ë“œ
â”œâ”€â”€ CORS_GUIDE.md                  # ğŸ” CORS ì„¤ì • ê°€ì´ë“œ
â””â”€â”€ README.md                      # ğŸ“š ì´ íŒŒì¼
```

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AWS EKS Cluster                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         lionpay Namespace                     â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Auth Service   â”‚  â”‚ Wallet Service   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   (Port 8080)   â”‚  â”‚  (Port 8081)     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚           â”‚                    â”‚            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ Auth Pods       â”‚  â”‚ Wallet Pods    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ (2 replicas)    â”‚  â”‚ (2 replicas)   â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚           â”‚                    â”‚            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚      ALB Ingress (HTTP)              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Routes:                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - /v1/auth â†’ auth-service          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - /v1/wallet â†’ wallet-service      â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚           â”‚                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                                    â”‚
â”‚    AWS Load Balancer (ALB)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚  CloudFront â”‚  (HTTPS/SSL Termination)
        â”‚  Distribution â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚
      api.lionpay.shop
```

## ğŸ¯ ì£¼ìš” íŠ¹ì§•

### âœ… ê³ ê°€ìš©ì„± (High Availability)
- **ë‹¤ì¤‘ ë³µì œë³¸**: Auth, Wallet ê° 2ê°œ Pod (í”„ë¡œë•ì…˜ì€ 3ê°œ)
- **Pod Anti-Affinity**: ê°™ì€ í˜¸ìŠ¤íŠ¸ì— 2ê°œ Pod ë°°ì¹˜ ë°©ì§€
- **Pod Disruption Budget**: ìµœì†Œ 1ê°œ Pod í•­ìƒ ì‹¤í–‰ ë³´ì¥

### ğŸ“ˆ ìë™ í™•ì¥ (Auto Scaling)
- **HPA ì„¤ì •**: CPU/Memory ê¸°ë°˜ ìë™ í™•ì¥
  - ìµœì†Œ: 2ê°œ Pod
  - ìµœëŒ€: 10ê°œ Pod
  - CPU 70%, Memory 80% ê¸°ì¤€

### ğŸ” ìƒíƒœ ëª¨ë‹ˆí„°ë§
- **Liveness Probe**: ì„œë¹„ìŠ¤ ì •ìƒ ì—¬ë¶€ ìë™ ê°ì§€
- **Readiness Probe**: íŠ¸ë˜í”½ ìˆ˜ì‹  ì¤€ë¹„ ìƒíƒœ í™•ì¸
- **Health Check Endpoints**: `/v1/auth/health`, `/v1/wallet/health`

### ğŸ”’ ë³´ì•ˆ & CORS
- CloudFrontê°€ HTTPS ì²˜ë¦¬ (ALBëŠ” HTTP only)
- CORS ì„¤ì •ìœ¼ë¡œ í”„ë¡ íŠ¸ì—”ë“œ ë„ë©”ì¸ ì ‘ê·¼ ì œì–´
- ECR ì´ë¯¸ì§€ë¡œ ì»¨í…Œì´ë„ˆ ë³´ì•ˆ

### ğŸ“Š í™˜ê²½ ê´€ë¦¬
- **Kustomize**: Baseì™€ Overlayë¡œ í™˜ê²½ë³„ ì„¤ì • ë¶„ë¦¬
- **Dev/Prod í™˜ê²½**: ê° í™˜ê²½ì— ë§ëŠ” ì»¤ìŠ¤í„°ë§ˆì´ì§•
- **ConfigMap**: í™˜ê²½ë³€ìˆ˜ ì¤‘ì•™ ê´€ë¦¬

## ğŸš€ ì‹œì‘í•˜ê¸°

### 1ï¸âƒ£ ë¹ ë¥¸ ì‹œì‘ (5ë¶„)
ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ìœ¼ë¡œ ë°°í¬í•˜ë ¤ë©´:
```bash
# QUICKSTART.md ì°¸ì¡°
cat QUICKSTART.md
```

### 2ï¸âƒ£ ìƒì„¸ ë°°í¬ (20ë¶„)
ëª¨ë“  ê³¼ì •ì„ ì´í•´í•˜ë©´ì„œ ë°°í¬í•˜ë ¤ë©´:
```bash
# DEPLOYMENT_GUIDE.md ì°¸ì¡°
cat DEPLOYMENT_GUIDE.md
```

### 3ï¸âƒ£ CORS ì„¤ì •
í”„ë¡ íŠ¸ì—”ë“œ-ë°±ì—”ë“œ í†µì‹  ì„¤ì •:
```bash
# CORS_GUIDE.md ì°¸ì¡°
cat CORS_GUIDE.md
```

## ğŸ“‹ í•„ìˆ˜ ì‚¬ì „ ì¡°ê±´

### AWS ë¦¬ì†ŒìŠ¤
- âœ… EKS í´ëŸ¬ìŠ¤í„° (lionpay-dev-eks)
- âœ… ECR ë¦¬í¬ì§€í† ë¦¬ (lionpay-auth, lionpay-wallet)
- âœ… ALB Ingress Controller ì„¤ì¹˜ë¨
- âœ… Metrics Server ì„¤ì¹˜ë¨ (HPAìš©)

### ë¡œì»¬ í™˜ê²½
```bash
# kubectl ì„¤ì¹˜
aws eks update-kubeconfig --name lionpay-dev-eks --region ap-northeast-2

# ë²„ì „ í™•ì¸
kubectl version --client
```

## ğŸ“ ë°°í¬ ë°©ë²• ë¹„êµ

| ë°©ë²• | ì¥ì  | ë‹¨ì  | ì¶”ì²œ |
|------|------|------|------|
| **kubectl apply** | ê°„ë‹¨, ë¹ ë¦„ | ìƒíƒœ ê´€ë¦¬ ì–´ë ¤ì›€ | í…ŒìŠ¤íŠ¸ìš© |
| **Kustomize** | í™˜ê²½ë³„ ê´€ë¦¬ ìš©ì´ | ì´ˆê¸° í•™ìŠµê³¡ì„  | â­ ì¶”ì²œ |
| **Helm** | ê°•ë ¥í•œ í…œí”Œë¦¿ | ë³µì¡í•¨ | ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸ |

## ğŸ”§ ì£¼ìš” ëª…ë ¹ì–´

### ë°°í¬
```bash
# Dev í™˜ê²½ ë°°í¬
kubectl apply -k kubernetes/overlays/dev

# Prod í™˜ê²½ ë°°í¬
kubectl apply -k kubernetes/overlays/prod
```

### ëª¨ë‹ˆí„°ë§
```bash
# Pod ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
kubectl get pods -n lionpay -w

# ë¡œê·¸ ë³´ê¸°
kubectl logs -n lionpay -l app=auth -f
```

### ì—…ë°ì´íŠ¸
```bash
# ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
kubectl set image deployment/auth-deployment \
  auth=<NEW_IMAGE> -n lionpay

# ë°°í¬ í™•ì¸
kubectl rollout status deployment/auth-deployment -n lionpay
```

### ë¡¤ë°±
```bash
# ì´ì „ ë²„ì „ìœ¼ë¡œ ëŒì•„ê°€ê¸°
kubectl rollout undo deployment/auth-deployment -n lionpay
```

## ğŸ“Š ì˜ˆìƒ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰

### Dev í™˜ê²½
| ë¦¬ì†ŒìŠ¤ | ìš”ì²­ | ì œí•œ |
|--------|------|------|
| CPU | 200m (2ê°œ Pod) | 1000m |
| Memory | 512Mi | 1Gi |

### Prod í™˜ê²½
| ë¦¬ì†ŒìŠ¤ | ìš”ì²­ | ì œí•œ |
|--------|------|------|
| CPU | 300m (3ê°œ Pod) | 1.5 |
| Memory | 768Mi | 1.5Gi |

## ğŸ†˜ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### Podì´ Running ìƒíƒœê°€ ì•„ë‹Œ ê²½ìš°
```bash
# ìƒì„¸ ì •ë³´ í™•ì¸
kubectl describe pod <POD_NAME> -n lionpay

# ë¡œê·¸ í™•ì¸
kubectl logs <POD_NAME> -n lionpay
```

### Ingressê°€ ALBë¥¼ ìƒì„±í•˜ì§€ ëª»í•œ ê²½ìš°
```bash
# ALB Ingress Controller ë¡œê·¸
kubectl logs -n kube-system -l app.kubernetes.io/name=aws-load-balancer-controller -f
```

### CORS ì˜¤ë¥˜
```bash
# CORS í—¤ë” í™•ì¸
curl -v https://api.lionpay.shop/v1/auth/health
```

ë” ìì„¸í•œ ë‚´ìš©ì€ **DEPLOYMENT_GUIDE.md** ì˜ "íŠ¸ëŸ¬ë¸”ìŠˆíŒ…" ì„¹ì…˜ ì°¸ì¡°.

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

| ë¬¸ì„œ | ì„¤ëª… |
|------|------|
| [QUICKSTART.md](./QUICKSTART.md) | 5ë¶„ ì•ˆì— ë°°í¬í•˜ê¸° |
| [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md) | ìƒì„¸í•œ ë°°í¬ ê°€ì´ë“œ |
| [CORS_GUIDE.md](./CORS_GUIDE.md) | CORS ì„¤ì • ë° ê²€ì¦ |

## ğŸ”— ì™¸ë¶€ ì°¸ê³ ìë£Œ

- [AWS EKS ê³µì‹ ë¬¸ì„œ](https://docs.aws.amazon.com/eks/)
- [Kubernetes ê³µì‹ ë¬¸ì„œ](https://kubernetes.io/docs/)
- [ALB Ingress Controller](https://kubernetes-sigs.github.io/aws-load-balancer-controller/)
- [Kustomize ê³µì‹ ë¬¸ì„œ](https://kustomize.io/)

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

ë°°í¬ ì „ í™•ì¸ì‚¬í•­:

- [ ] AWS ê³„ì • ID í™•ì¸ë¨
- [ ] EKS í´ëŸ¬ìŠ¤í„° ì ‘ê·¼ ê°€ëŠ¥ (`kubectl cluster-info`)
- [ ] ECR ì´ë¯¸ì§€ ë¹Œë“œë¨ (lionpay-auth, lionpay-wallet)
- [ ] ALB Ingress Controller ì„¤ì¹˜ë¨
- [ ] Metrics Server ì„¤ì¹˜ë¨
- [ ] Route53 DNS ì„¤ì •ë¨
- [ ] ACM ì¸ì¦ì„œ ë°œê¸‰ë¨ (CloudFrontìš©)

## ğŸ‘¥ íŒ€ ì •ë³´

- **í”„ë¡œì íŠ¸**: LionPay
- **ì•„í‚¤í…ì²˜**: EKS + CloudFront + ALB
- **ë°°í¬ ë„êµ¬**: Kustomize
- **ì‘ì„±ì¼**: 2025ë…„ 12ì›” 30ì¼

---

**ì‹œì‘í•˜ê¸°**: [QUICKSTART.md](./QUICKSTART.md) ë¥¼ ë¨¼ì € ì½ì–´ë³´ì„¸ìš”! ğŸš€
